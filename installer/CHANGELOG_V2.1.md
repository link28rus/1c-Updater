# Версия 2.1 - Исправление ошибки 1053

## Проблема
Ошибка 1053 при запуске службы: "Служба не ответила на запрос своевременно"

## Исправления

### 1. Копирование агента в системную папку
- **Проблема:** Агент находился в папке Downloads, что могло вызывать проблемы с правами доступа
- **Решение:** Агент теперь автоматически копируется в `C:\Program Files\1CUpdaterAgent\` перед созданием службы
- **Преимущества:**
  - Стандартное расположение для служб Windows
  - Нет проблем с правами доступа
  - Файл защищен от случайного удаления

### 2. Улучшенное логирование в Program.cs
- Добавлено создание источника событий EventLog при запуске
- Логирование начала запуска службы
- Логирование успешного создания host
- Подробные сообщения об ошибках с типом исключения

### 3. Улучшенная диагностика в установщике
- Увеличена задержка после запуска службы до 5 секунд
- Проверка EventLog на наличие ошибок
- Отображение последних 5 записей из EventLog
- Показ ExitCode службы

### 4. Улучшенная обработка ошибок
- Try-catch в Main для перехвата критических ошибок
- Логирование ошибок загрузки конфигурации
- Служба не падает молча

## Что изменилось в процессе установки

1. **Скачивание агента** → `C:\Users\...\Downloads\1CUpdaterAgent.exe`
2. **Копирование в системную папку** → `C:\Program Files\1CUpdaterAgent\1CUpdaterAgent.exe`
3. **Создание службы** с путем к системной папке
4. **Создание конфигурации** → `C:\ProgramData\1CUpdaterAgent\config.json`
5. **Запуск службы** с увеличенной задержкой и проверкой EventLog

## Проверка после установки

Если служба не запустилась, проверьте:

1. **EventLog:**
   ```powershell
   Get-EventLog -LogName Application -Source "1CUpdaterAgent" -Newest 10
   ```

2. **Статус службы:**
   ```powershell
   Get-Service -Name "1CUpdaterAgent"
   sc.exe query "1CUpdaterAgent"
   ```

3. **Файлы:**
   - `C:\Program Files\1CUpdaterAgent\1CUpdaterAgent.exe` - должен существовать
   - `C:\ProgramData\1CUpdaterAgent\config.json` - должен существовать и быть валидным JSON

4. **Права доступа:**
   - Служба должна иметь права на чтение файла агента
   - Служба должна иметь права на чтение/запись конфигурации

## Ожидаемый результат

После установки:
- ✅ Агент находится в `C:\Program Files\1CUpdaterAgent\`
- ✅ Конфигурация в `C:\ProgramData\1CUpdaterAgent\config.json`
- ✅ Служба запущена и работает
- ✅ В EventLog есть записи о запуске службы


